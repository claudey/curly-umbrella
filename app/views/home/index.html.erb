<!-- Dashboard Header -->
<div class="flex justify-between items-center mb-6">
  <div>
    <h1 class="text-3xl font-bold">Dashboard</h1>
    <p class="text-base-content/70 mt-1">Welcome back, <%= current_user.display_name %>! Here's what's happening with your documents.</p>
  </div>
  
  <div class="flex gap-2">
    <%= link_to "Upload Document", new_document_path, class: "btn btn-primary" %>
    <%= link_to "View All Documents", documents_path, class: "btn btn-outline btn-primary" %>
  </div>
</div>

<!-- Key Metrics Row -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
  <!-- Total Documents Card -->
  <div class="card bg-primary text-primary-content">
    <div class="card-body">
      <div class="flex justify-between items-center">
        <div>
          <h2 class="card-title text-2xl font-bold"><%= number_with_delimiter(@document_metrics[:total_documents]) %></h2>
          <p>Total Documents</p>
        </div>
        <div class="text-3xl opacity-70">üìÑ</div>
      </div>
      <div class="text-xs opacity-70 mt-2">
        +<%= @document_metrics[:documents_this_month] %> this month
      </div>
    </div>
  </div>
  
  <!-- Active Documents Card -->
  <div class="card bg-success text-success-content">
    <div class="card-body">
      <div class="flex justify-between items-center">
        <div>
          <h2 class="card-title text-2xl font-bold"><%= number_with_delimiter(@document_metrics[:active_documents]) %></h2>
          <p>Active Documents</p>
        </div>
        <div class="text-3xl opacity-70">‚úÖ</div>
      </div>
      <div class="text-xs opacity-70 mt-2">
        <%= number_to_percentage((@document_metrics[:active_documents].to_f / [@document_metrics[:total_documents], 1].max) * 100, precision: 1) %> of total
      </div>
    </div>
  </div>
  
  <!-- Expiring Soon Card -->
  <div class="card bg-warning text-warning-content">
    <div class="card-body">
      <div class="flex justify-between items-center">
        <div>
          <h2 class="card-title text-2xl font-bold"><%= @document_metrics[:expiring_soon] %></h2>
          <p>Expiring Soon</p>
        </div>
        <div class="text-3xl opacity-70">‚è∞</div>
      </div>
      <div class="text-xs opacity-70 mt-2">
        Next 7 days
      </div>
    </div>
  </div>
  
  <!-- Storage Used Card -->
  <div class="card bg-info text-info-content">
    <div class="card-body">
      <div class="flex justify-between items-center">
        <div>
          <h2 class="card-title text-2xl font-bold"><%= format_file_size(@document_metrics[:total_file_size]) %></h2>
          <p>Storage Used</p>
        </div>
        <div class="text-3xl opacity-70">‚òÅÔ∏è</div>
      </div>
      <div class="text-xs opacity-70 mt-2">
        Across all documents
      </div>
    </div>
  </div>
</div>

<!-- Main Dashboard Content -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
  <!-- Left Column - Main Content -->
  <div class="lg:col-span-2 space-y-6">
    <!-- Recent Documents -->
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <div class="flex justify-between items-center mb-4">
          <h2 class="card-title">Recent Documents</h2>
          <%= link_to "View All", documents_path, class: "btn btn-sm btn-outline" %>
        </div>
        
        <% if @recent_documents.any? %>
          <div class="overflow-x-auto">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Document</th>
                  <th>Type</th>
                  <th>Size</th>
                  <th>Created</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <% @recent_documents.each do |document| %>
                  <tr>
                    <td>
                      <div class="flex items-center space-x-3">
                        <div class="text-lg">üìÑ</div>
                        <div>
                          <%= link_to document.name, document, class: "link font-semibold" %>
                          <% if document.description.present? %>
                            <br><div class="text-sm opacity-70"><%= truncate(document.description, length: 40) %></div>
                          <% end %>
                        </div>
                      </div>
                    </td>
                    <td><div class="badge badge-outline"><%= document.document_type.humanize %></div></td>
                    <td><%= document.human_file_size %></td>
                    <td>
                      <%= time_ago_in_words(document.created_at) %> ago
                      <br><div class="text-sm opacity-70">by <%= document.user.full_name %></div>
                    </td>
                    <td>
                      <div class="flex gap-1">
                        <%= link_to "View", document, class: "btn btn-xs btn-outline" %>
                        <%= link_to "Download", download_document_path(document), class: "btn btn-xs btn-ghost" %>
                      </div>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        <% else %>
          <div class="text-center py-8">
            <div class="text-4xl mb-4">üìÑ</div>
            <p class="text-base-content/70">No documents yet. <%= link_to "Upload your first document", new_document_path, class: "link link-primary" %>.</p>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Document Type Breakdown Chart -->
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <h2 class="card-title mb-4">Document Types Overview</h2>
        
        <% if @document_type_breakdown.any? %>
          <div class="space-y-4">
            <% @document_type_breakdown.each do |type, count| %>
              <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                  <div class="text-lg">üìÅ</div>
                  <span><%= type.humanize %></span>
                </div>
                <div class="flex items-center space-x-2">
                  <div class="badge badge-outline"><%= count %></div>
                  <progress class="progress progress-primary w-16" value="<%= (count.to_f / @document_metrics[:total_documents] * 100).round(1) %>" max="100"></progress>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="text-center py-4">
            <p class="text-base-content/70">No document data available yet.</p>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Right Column - Sidebar Content -->
  <div class="space-y-6">
    <!-- Quick Actions -->
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <h3 class="card-title mb-4">Quick Actions</h3>
        <div class="space-y-2">
          <%= link_to new_document_path, class: "btn btn-primary w-full justify-start" do %>
            üì§ Upload Document
          <% end %>
          <%= link_to documents_path, class: "btn btn-outline w-full justify-start" do %>
            üîç Browse Documents
          <% end %>
          <%= link_to archived_documents_path, class: "btn btn-outline w-full justify-start" do %>
            üì¶ View Archived
          <% end %>
          <%= link_to expiring_documents_path, class: "btn btn-warning w-full justify-start" do %>
            ‚è∞ Expiring Documents
          <% end %>
        </div>
      </div>
    </div>

    <!-- Upcoming Tasks -->
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <h3 class="card-title mb-4">Upcoming Tasks</h3>
        
        <% if @upcoming_tasks.any? %>
          <div class="space-y-3">
            <% @upcoming_tasks.first(5).each do |task| %>
              <div class="flex justify-between items-start p-3 bg-base-200 rounded-lg">
                <div class="flex-1">
                  <%= link_to task[:title], task[:url], class: "link font-semibold" %>
                  <div class="text-sm text-base-content/70 mt-1"><%= task[:description] %></div>
                </div>
                <% if task[:priority] == 'high' %>
                  <div class="badge badge-error"><%= task[:priority] %></div>
                <% elsif task[:priority] == 'medium' %>
                  <div class="badge badge-warning"><%= task[:priority] %></div>
                <% else %>
                  <div class="badge badge-ghost"><%= task[:priority] %></div>
                <% end %>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="text-center py-6">
            <div class="text-4xl mb-2">‚úÖ</div>
            <p class="text-base-content/70">All caught up!</p>
          </div>
        <% end %>
      </div>
    </div>

    <!-- My Recent Documents -->
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <h3 class="card-title mb-4">My Recent Documents</h3>
        
        <% if @my_recent_documents.any? %>
          <div class="space-y-3">
            <% @my_recent_documents.each do |document| %>
              <div class="flex items-center space-x-3 p-2 hover:bg-base-200 rounded-lg transition-colors">
                <div class="text-lg">üìÑ</div>
                <div class="flex-1">
                  <%= link_to document.name, document, class: "link font-semibold block" %>
                  <div class="text-sm text-base-content/70">
                    <%= time_ago_in_words(document.created_at) %> ago ‚Ä¢ <%= document.human_file_size %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
          <div class="mt-4 text-center">
            <%= link_to "View all my documents", documents_path(user: current_user.id), class: "btn btn-sm btn-outline" %>
          </div>
        <% else %>
          <div class="text-center py-4">
            <p class="text-base-content/70">No recent documents</p>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Storage & System Info -->
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <h3 class="card-title mb-4">Storage & System Info</h3>
        
        <div class="space-y-3">
          <div class="flex justify-between">
            <span>Documents</span>
            <span class="font-mono"><%= @document_metrics[:total_documents] %></span>
          </div>
          <div class="flex justify-between">
            <span>Total Storage</span>
            <span class="font-mono"><%= format_file_size(@document_metrics[:total_file_size]) %></span>
          </div>
          <div class="flex justify-between">
            <span>Organization Users</span>
            <span class="font-mono"><%= @system_metrics[:total_users] %></span>
          </div>
          <% if @system_metrics[:total_applications] > 0 %>
            <div class="flex justify-between">
              <span>Applications</span>
              <span class="font-mono"><%= @system_metrics[:total_applications] %></span>
            </div>
          <% end %>
        </div>
        
        <% if @category_breakdown.any? %>
          <div class="divider">Top Categories</div>
          <div class="space-y-2">
            <% @category_breakdown.each do |category, count| %>
              <div class="flex justify-between items-center">
                <span><%= category.humanize %></span>
                <div class="badge badge-neutral"><%= count %></div>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
