<div class="container mx-auto px-4 py-8">
  <!-- Header -->
  <div class="flex items-center justify-between mb-6">
    <div class="flex items-center gap-4">
      <%= link_to insurance_companies_applications_path, class: "btn btn-ghost btn-circle" do %>
        <%= icon("arrow-left") %>
      <% end %>
      <div>
        <h1 class="text-3xl font-bold text-gray-900">
          Application <%= @application.application_number %>
        </h1>
        <p class="text-gray-600 mt-1">
          Submitted by <%= @application.organization.name %> â€¢ 
          <%= time_ago_in_words(@application.submitted_at || @application.created_at) %> ago
        </p>
      </div>
    </div>
    
    <div class="flex items-center gap-3">
      <span class="badge <%= @application.status_badge_class %> badge-lg">
        <%= @application.status.humanize %>
      </span>
      
      <% if @existing_quote %>
        <%= link_to insurance_companies_quote_path(@existing_quote), 
                   class: "btn btn-outline" do %>
          <%= icon("document-text") %>
          View My Quote
        <% end %>
      <% else %>
        <%= link_to insurance_companies_new_quote_path(application_id: @application.id), 
                   class: "btn btn-primary" do %>
          <%= icon("plus") %>
          Create Quote
        <% end %>
      <% end %>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Main Content -->
    <div class="lg:col-span-2 space-y-6">
      <!-- Client Information -->
      <div class="card bg-base-100 shadow-sm">
        <div class="card-body">
          <h2 class="card-title text-xl mb-4">Client Information</h2>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <h3 class="font-semibold text-lg mb-3">Personal Details</h3>
              <div class="space-y-2">
                <div class="flex justify-between">
                  <span class="text-gray-600">Full Name:</span>
                  <span class="font-medium"><%= @application.client_name %></span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Age:</span>
                  <span class="font-medium"><%= @application.driver_age || 'Not specified' %></span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Gender:</span>
                  <span class="font-medium"><%= @application.client.gender&.humanize || 'Not specified' %></span>
                </div>
                <% if @application.client.phone.present? %>
                  <div class="flex justify-between">
                    <span class="text-gray-600">Phone:</span>
                    <span class="font-medium"><%= @application.client.phone %></span>
                  </div>
                <% end %>
              </div>
            </div>
            
            <div>
              <h3 class="font-semibold text-lg mb-3">Driver Information</h3>
              <div class="space-y-2">
                <div class="flex justify-between">
                  <span class="text-gray-600">License Number:</span>
                  <span class="font-medium"><%= @application.driver_license_number %></span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">License Expires:</span>
                  <span class="font-medium">
                    <%= @application.driver_license_expiry.strftime("%b %d, %Y") if @application.driver_license_expiry %>
                  </span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Previous Claims:</span>
                  <span class="font-medium">
                    <% if @application.driver_has_claims? %>
                      <span class="badge badge-warning badge-sm">Yes</span>
                    <% else %>
                      <span class="badge badge-success badge-sm">No Claims</span>
                    <% end %>
                  </span>
                </div>
              </div>
            </div>
          </div>
          
          <% if @application.driver_has_claims? && @application.driver_claims_details.present? %>
            <div class="mt-6">
              <h3 class="font-semibold text-lg mb-3">Claims History</h3>
              <div class="bg-base-200 p-4 rounded-lg">
                <%= simple_format(@application.driver_claims_details) %>
              </div>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Vehicle Information -->
      <div class="card bg-base-100 shadow-sm">
        <div class="card-body">
          <h2 class="card-title text-xl mb-4">Vehicle Information</h2>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <h3 class="font-semibold text-lg mb-3">Basic Details</h3>
              <div class="space-y-2">
                <div class="flex justify-between">
                  <span class="text-gray-600">Make & Model:</span>
                  <span class="font-medium"><%= @application.vehicle_make %> <%= @application.vehicle_model %></span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Year:</span>
                  <span class="font-medium"><%= @application.vehicle_year %></span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Category:</span>
                  <span class="font-medium"><%= @application.vehicle_category&.humanize %></span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Usage:</span>
                  <span class="font-medium"><%= @application.vehicle_usage&.humanize %></span>
                </div>
              </div>
            </div>
            
            <div>
              <h3 class="font-semibold text-lg mb-3">Technical Specs</h3>
              <div class="space-y-2">
                <% if @application.vehicle_registration.present? %>
                  <div class="flex justify-between">
                    <span class="text-gray-600">Registration:</span>
                    <span class="font-medium"><%= @application.vehicle_registration %></span>
                  </div>
                <% end %>
                <% if @application.vehicle_vin.present? %>
                  <div class="flex justify-between">
                    <span class="text-gray-600">VIN:</span>
                    <span class="font-medium font-mono text-sm"><%= @application.vehicle_vin %></span>
                  </div>
                <% end %>
                <% if @application.vehicle_engine_size.present? %>
                  <div class="flex justify-between">
                    <span class="text-gray-600">Engine Size:</span>
                    <span class="font-medium"><%= @application.vehicle_engine_size %>L</span>
                  </div>
                <% end %>
                <% if @application.vehicle_fuel_type.present? %>
                  <div class="flex justify-between">
                    <span class="text-gray-600">Fuel Type:</span>
                    <span class="font-medium"><%= @application.vehicle_fuel_type&.humanize %></span>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Coverage Requirements -->
      <div class="card bg-base-100 shadow-sm">
        <div class="card-body">
          <h2 class="card-title text-xl mb-4">Coverage Requirements</h2>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <h3 class="font-semibold text-lg mb-3">Coverage Details</h3>
              <div class="space-y-2">
                <div class="flex justify-between">
                  <span class="text-gray-600">Type:</span>
                  <span class="badge badge-primary">
                    <%= @application.coverage_type&.humanize %>
                  </span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Start Date:</span>
                  <span class="font-medium">
                    <%= @application.coverage_start_date.strftime("%b %d, %Y") if @application.coverage_start_date %>
                  </span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">End Date:</span>
                  <span class="font-medium">
                    <%= @application.coverage_end_date.strftime("%b %d, %Y") if @application.coverage_end_date %>
                  </span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Duration:</span>
                  <span class="font-medium">
                    <% if @application.coverage_start_date && @application.coverage_end_date %>
                      <%= distance_of_time_in_words(@application.coverage_start_date, @application.coverage_end_date) %>
                    <% end %>
                  </span>
                </div>
              </div>
            </div>
            
            <div>
              <h3 class="font-semibold text-lg mb-3">Financial Details</h3>
              <div class="space-y-2">
                <% if @application.sum_insured %>
                  <div class="flex justify-between">
                    <span class="text-gray-600">Sum Insured:</span>
                    <span class="font-medium text-lg">$<%= number_with_delimiter(@application.sum_insured) %></span>
                  </div>
                <% end %>
                <% if @application.premium_amount %>
                  <div class="flex justify-between">
                    <span class="text-gray-600">Broker's Estimate:</span>
                    <span class="font-medium">$<%= number_with_delimiter(@application.premium_amount) %></span>
                  </div>
                <% end %>
                <% if @application.commission_rate %>
                  <div class="flex justify-between">
                    <span class="text-gray-600">Commission Rate:</span>
                    <span class="font-medium"><%= number_to_percentage(@application.commission_rate, precision: 1) %></span>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Additional Information -->
      <% if @application.notes.present? %>
        <div class="card bg-base-100 shadow-sm">
          <div class="card-body">
            <h2 class="card-title text-xl mb-4">Additional Notes</h2>
            <div class="prose max-w-none">
              <%= simple_format(@application.notes) %>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Sidebar -->
    <div class="lg:col-span-1 space-y-6">
      <!-- Risk Assessment -->
      <div class="card bg-base-100 shadow-sm">
        <div class="card-body">
          <h3 class="card-title text-lg mb-4">Risk Assessment</h3>
          
          <div class="space-y-3">
            <!-- Driver Risk -->
            <div>
              <div class="text-sm font-medium mb-2">Driver Risk Factors</div>
              <div class="space-y-1">
                <% if @application.driver_age && @application.driver_age < 25 %>
                  <div class="badge badge-warning badge-sm w-full justify-start">
                    <%= icon("exclamation-triangle", class: "w-3 h-3 mr-1") %>
                    Young driver (under 25)
                  </div>
                <% elsif @application.driver_age && @application.driver_age > 65 %>
                  <div class="badge badge-info badge-sm w-full justify-start">
                    <%= icon("information-circle", class: "w-3 h-3 mr-1") %>
                    Senior driver (over 65)
                  </div>
                <% else %>
                  <div class="badge badge-success badge-sm w-full justify-start">
                    <%= icon("check", class: "w-3 h-3 mr-1") %>
                    Standard age range
                  </div>
                <% end %>
                
                <% if @application.driver_has_claims? %>
                  <div class="badge badge-error badge-sm w-full justify-start">
                    <%= icon("exclamation-triangle", class: "w-3 h-3 mr-1") %>
                    Previous claims history
                  </div>
                <% else %>
                  <div class="badge badge-success badge-sm w-full justify-start">
                    <%= icon("shield-check", class: "w-3 h-3 mr-1") %>
                    No claims bonus
                  </div>
                <% end %>
              </div>
            </div>

            <!-- Vehicle Risk -->
            <div>
              <div class="text-sm font-medium mb-2">Vehicle Risk Factors</div>
              <div class="space-y-1">
                <% if @application.vehicle_year && @application.vehicle_year < (Date.current.year - 10) %>
                  <div class="badge badge-warning badge-sm w-full justify-start">
                    <%= icon("exclamation-triangle", class: "w-3 h-3 mr-1") %>
                    Older vehicle (10+ years)
                  </div>
                <% else %>
                  <div class="badge badge-success badge-sm w-full justify-start">
                    <%= icon("check", class: "w-3 h-3 mr-1") %>
                    Modern vehicle
                  </div>
                <% end %>
                
                <% if @application.vehicle_usage == 'commercial' %>
                  <div class="badge badge-warning badge-sm w-full justify-start">
                    <%= icon("truck", class: "w-3 h-3 mr-1") %>
                    Commercial usage
                  </div>
                <% else %>
                  <div class="badge badge-success badge-sm w-full justify-start">
                    <%= icon("home", class: "w-3 h-3 mr-1") %>
                    Personal usage
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Brokerage Information -->
      <div class="card bg-base-100 shadow-sm">
        <div class="card-body">
          <h3 class="card-title text-lg mb-4">Brokerage Details</h3>
          
          <div class="space-y-3">
            <div>
              <span class="text-gray-600 text-sm">Organization</span>
              <div class="font-medium"><%= @application.organization.name %></div>
            </div>
            
            <% if @application.organization.license_number.present? %>
              <div>
                <span class="text-gray-600 text-sm">License Number</span>
                <div class="font-medium"><%= @application.organization.license_number %></div>
              </div>
            <% end %>
            
            <div>
              <span class="text-gray-600 text-sm">Application Submitted</span>
              <div class="font-medium">
                <%= (@application.submitted_at || @application.created_at).strftime("%b %d, %Y at %I:%M %p") %>
              </div>
            </div>
            
            <% if @application.reviewed_by %>
              <div>
                <span class="text-gray-600 text-sm">Reviewed By</span>
                <div class="font-medium"><%= @application.reviewed_by.full_name %></div>
              </div>
            <% end %>
          </div>
        </div>
      </div>

      <!-- Application Timeline -->
      <div class="card bg-base-100 shadow-sm">
        <div class="card-body">
          <h3 class="card-title text-lg mb-4">Timeline</h3>
          
          <div class="space-y-3">
            <div class="flex items-center gap-3">
              <div class="w-2 h-2 bg-primary rounded-full"></div>
              <div>
                <div class="font-medium text-sm">Application Created</div>
                <div class="text-xs text-gray-500">
                  <%= @application.created_at.strftime("%b %d, %Y at %I:%M %p") %>
                </div>
              </div>
            </div>
            
            <% if @application.submitted_at %>
              <div class="flex items-center gap-3">
                <div class="w-2 h-2 bg-info rounded-full"></div>
                <div>
                  <div class="font-medium text-sm">Application Submitted</div>
                  <div class="text-xs text-gray-500">
                    <%= @application.submitted_at.strftime("%b %d, %Y at %I:%M %p") %>
                  </div>
                </div>
              </div>
            <% end %>
            
            <% if @application.reviewed_at %>
              <div class="flex items-center gap-3">
                <div class="w-2 h-2 bg-warning rounded-full"></div>
                <div>
                  <div class="font-medium text-sm">Under Review</div>
                  <div class="text-xs text-gray-500">
                    <%= @application.reviewed_at.strftime("%b %d, %Y at %I:%M %p") %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="card bg-base-100 shadow-sm">
        <div class="card-body">
          <h3 class="card-title text-lg mb-4">Actions</h3>
          
          <div class="space-y-2">
            <% if @existing_quote %>
              <%= link_to insurance_companies_quote_path(@existing_quote), 
                         class: "btn btn-outline btn-sm w-full" do %>
                <%= icon("document-text", class: "w-4 h-4") %>
                View My Quote
              <% end %>
              
              <% if @existing_quote.draft? %>
                <%= link_to "Edit Quote", "#", class: "btn btn-ghost btn-sm w-full" %>
              <% end %>
            <% else %>
              <%= link_to insurance_companies_new_quote_path(application_id: @application.id), 
                         class: "btn btn-primary btn-sm w-full" do %>
                <%= icon("plus", class: "w-4 h-4") %>
                Create Quote
              <% end %>
            <% end %>
            
            <button class="btn btn-ghost btn-sm w-full" onclick="window.print()">
              <%= icon("printer", class: "w-4 h-4") %>
              Print Application
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>