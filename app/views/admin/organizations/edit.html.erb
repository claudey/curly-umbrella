<% content_for :title, "Edit #{@organization.name}" %>

<div class="container mx-auto p-6 max-w-4xl">
  <!-- Header -->
  <div class="mb-8">
    <div class="breadcrumbs text-sm">
      <ul>
        <li><%= link_to "Organizations", admin_organizations_path, class: "link" %></li>
        <li><%= link_to @organization.name, admin_organization_path(@organization), class: "link" %></li>
        <li>Edit</li>
      </ul>
    </div>
    <h1 class="text-3xl font-bold text-base-content">Edit Organization</h1>
    <p class="text-base-content/60 mt-1">Update organization settings and information</p>
  </div>
  
  <%= form_with model: [:admin, @organization], 
                local: true, 
                class: "space-y-6" do |form| %>
    
    <!-- Basic Information -->
    <div class="card bg-base-100 shadow">
      <div class="card-body">
        <h2 class="card-title mb-4">
          <i class="ph ph-info"></i>
          Basic Information
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="form-control">
            <label class="label">
              <span class="label-text">Organization Name *</span>
            </label>
            <%= form.text_field :name,
                               class: "input input-bordered #{'input-error' if @organization.errors[:name].any?}",
                               required: true %>
            <% if @organization.errors[:name].any? %>
              <label class="label">
                <span class="label-text-alt text-error"><%= @organization.errors[:name].first %></span>
              </label>
            <% end %>
          </div>
          
          <div class="form-control">
            <label class="label">
              <span class="label-text">Subdomain *</span>
            </label>
            <div class="join">
              <%= form.text_field :subdomain,
                                 class: "input input-bordered join-item flex-1 #{'input-error' if @organization.errors[:subdomain].any?}",
                                 required: true %>
              <span class="bg-base-200 join-item flex items-center px-3 text-sm text-base-content/60">
                .brokersync.com
              </span>
            </div>
            <% if @organization.errors[:subdomain].any? %>
              <label class="label">
                <span class="label-text-alt text-error"><%= @organization.errors[:subdomain].first %></span>
              </label>
            <% end %>
          </div>
        </div>
        
        <div class="form-control">
          <label class="label">
            <span class="label-text">Description</span>
          </label>
          <%= form.textarea :description,
                           class: "textarea textarea-bordered",
                           rows: 3 %>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="form-control">
            <label class="label">
              <span class="label-text">Plan</span>
            </label>
            <%= form.select :plan,
                           options_for_select([
                             ['Starter', 'starter'],
                             ['Professional', 'professional'],
                             ['Enterprise', 'enterprise']
                           ], @organization.plan),
                           { prompt: 'Select a plan' },
                           { class: "select select-bordered" } %>
          </div>
          
          <div class="form-control">
            <label class="label">
              <span class="label-text">Billing Email</span>
            </label>
            <%= form.email_field :billing_email,
                                class: "input input-bordered" %>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Contact Information -->
    <div class="card bg-base-100 shadow">
      <div class="card-body">
        <h2 class="card-title mb-4">
          <i class="ph ph-address-book"></i>
          Contact Information
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="form-control md:col-span-2">
            <label class="label">
              <span class="label-text">Address</span>
            </label>
            <%= form.text_field "contact_info[address]",
                               value: @organization.contact_info&.dig('address'),
                               class: "input input-bordered" %>
          </div>
          
          <div class="form-control">
            <label class="label">
              <span class="label-text">City</span>
            </label>
            <%= form.text_field "contact_info[city]",
                               value: @organization.contact_info&.dig('city'),
                               class: "input input-bordered" %>
          </div>
          
          <div class="form-control">
            <label class="label">
              <span class="label-text">State/Province</span>
            </label>
            <%= form.text_field "contact_info[state]",
                               value: @organization.contact_info&.dig('state'),
                               class: "input input-bordered" %>
          </div>
          
          <div class="form-control">
            <label class="label">
              <span class="label-text">Postal Code</span>
            </label>
            <%= form.text_field "contact_info[postal_code]",
                               value: @organization.contact_info&.dig('postal_code'),
                               class: "input input-bordered" %>
          </div>
          
          <div class="form-control">
            <label class="label">
              <span class="label-text">Country</span>
            </label>
            <%= form.text_field "contact_info[country]",
                               value: @organization.contact_info&.dig('country'),
                               class: "input input-bordered" %>
          </div>
          
          <div class="form-control">
            <label class="label">
              <span class="label-text">Phone</span>
            </label>
            <%= form.telephone_field "contact_info[phone]",
                                    value: @organization.contact_info&.dig('phone'),
                                    class: "input input-bordered" %>
          </div>
          
          <div class="form-control">
            <label class="label">
              <span class="label-text">Website</span>
            </label>
            <%= form.url_field "contact_info[website]",
                              value: @organization.contact_info&.dig('website'),
                              class: "input input-bordered" %>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Settings -->
    <div class="card bg-base-100 shadow">
      <div class="card-body">
        <h2 class="card-title mb-4">
          <i class="ph ph-gear"></i>
          Organization Settings
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="form-control">
            <label class="label">
              <span class="label-text">Maximum Users</span>
            </label>
            <%= form.number_field :max_users,
                                 class: "input input-bordered",
                                 min: 1 %>
            <label class="label">
              <span class="label-text-alt">Leave blank for unlimited</span>
            </label>
          </div>
          
          <div class="form-control">
            <label class="label">
              <span class="label-text">Maximum Applications</span>
            </label>
            <%= form.number_field :max_applications,
                                 class: "input input-bordered",
                                 min: 1 %>
            <label class="label">
              <span class="label-text-alt">Leave blank for unlimited</span>
            </label>
          </div>
        </div>
        
        <div class="form-control">
          <label class="label cursor-pointer">
            <span class="label-text">
              <span class="font-medium">Active Organization</span>
              <span class="text-sm text-base-content/60 block">Users can access this organization</span>
            </span>
            <%= form.check_box :active, 
                              {}, 
                              "true", "false",
                              class: "toggle toggle-primary" %>
          </label>
        </div>
      </div>
    </div>
    
    <!-- Actions -->
    <div class="card bg-base-100 shadow">
      <div class="card-body">
        <div class="card-actions justify-end gap-4">
          <%= link_to admin_organization_path(@organization), class: "btn btn-ghost" do %>
            Cancel
          <% end %>
          
          <%= form.submit "Update Organization", 
                         class: "btn btn-primary",
                         data: { disable_with: "Updating..." } %>
        </div>
      </div>
    </div>
  <% end %>
</div>