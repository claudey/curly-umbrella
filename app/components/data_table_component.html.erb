<div class="overflow-x-auto" data-controller="data-table" data-data-table-id-value="<%= @id %>">
  <% if @searchable %>
    <div class="mb-4">
      <input type="text" 
             placeholder="Search..." 
             class="input input-bordered w-full max-w-xs"
             data-data-table-target="search"
             data-action="input->data-table#search">
    </div>
  <% end %>

  <% if @loading %>
    <div class="flex justify-center items-center py-8">
      <span class="loading loading-spinner loading-lg"></span>
    </div>
  <% elsif @rows.empty? %>
    <div class="text-center py-8">
      <div class="text-base-content/60">
        <%= icon('inbox', class: 'w-12 h-12 mx-auto mb-2 opacity-50') %>
        <p><%= @empty_message %></p>
      </div>
    </div>
  <% else %>
    <table class="<%= table_classes %>" data-data-table-target="table">
      <thead>
        <tr>
          <% @headers.each do |header| %>
            <% column_key = header[:key] || header[:label]&.downcase&.gsub(/\s+/, '_') %>
            <th class="<%= header_classes(header) %>" 
                <% if @sortable && header[:sortable] != false %>
                  data-action="click->data-table#sort" 
                  data-column="<%= column_key %>"
                <% end %>>
              <div class="flex items-center justify-between">
                <%= header[:label] %>
                <% if @sortable && header[:sortable] != false %>
                  <%= sort_icon(column_key, {}) %>
                <% end %>
              </div>
            </th>
          <% end %>
          <% if @actions.any? %>
            <th class="<%= header_classes({}) %>">Actions</th>
          <% end %>
        </tr>
      </thead>
      <tbody data-data-table-target="tbody">
        <% @rows.each_with_index do |row, index| %>
          <tr data-data-table-target="row" data-row-index="<%= index %>">
            <% @headers.each do |header| %>
              <% column_key = header[:key] || header[:label]&.downcase&.gsub(/\s+/, '_') %>
              <td class="<%= cell_classes(header) %>">
                <%= render_cell_content(row, column_key, header) %>
              </td>
            <% end %>
            
            <% if @actions.any? %>
              <td>
                <div class="flex gap-1">
                  <% @actions.each do |action| %>
                    <% if action[:condition].nil? || action[:condition].call(row) %>
                      <%= link_to action[:url].call(row), 
                                 class: action_button_class(action),
                                 title: action[:title],
                                 data: action[:data] || {},
                                 method: action[:method] || :get do %>
                        <% if action[:icon] %>
                          <%= icon(action[:icon], class: 'w-3 h-3') %>
                        <% end %>
                        <% if action[:label] %>
                          <span class="<%= 'ml-1' if action[:icon] %>"><%= action[:label] %></span>
                        <% end %>
                      <% end %>
                    <% end %>
                  <% end %>
                </div>
              </td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>

  <% if @paginated %>
    <div class="mt-4 flex justify-center">
      <!-- Pagination would be implemented here -->
      <!-- This would typically integrate with Kaminari or similar -->
    </div>
  <% end %>
</div>